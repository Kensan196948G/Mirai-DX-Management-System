# CDCP Production Environment Variables
# ==========================================
# このファイルをコピーして .env.production を作成してください
# 機密情報は必ず .gitignore に追加されていることを確認してください
# 本番環境の設定は厳重に管理してください

# --- Application ---
NODE_ENV=production
PORT=3000
API_BASE_URL=https://api.cdcp.example.com

# --- Database (RDS PostgreSQL Multi-AZ) ---
DATABASE_URL=postgresql://cdcp_prod:CHANGE_ME_STRONG_PASSWORD@cdcp-production-db.xxxxx.ap-northeast-1.rds.amazonaws.com:5432/cdcp_production
DATABASE_HOST=cdcp-production-db.xxxxx.ap-northeast-1.rds.amazonaws.com
DATABASE_PORT=5432
DATABASE_NAME=cdcp_production
DATABASE_USER=cdcp_prod
DATABASE_PASSWORD=CHANGE_ME_STRONG_PASSWORD
DATABASE_SSL=true
DATABASE_POOL_MIN=5
DATABASE_POOL_MAX=20

# RDS Read Replica (Phase2+)
DATABASE_READ_REPLICA_URL=postgresql://cdcp_prod:CHANGE_ME_STRONG_PASSWORD@cdcp-production-db-ro.xxxxx.ap-northeast-1.rds.amazonaws.com:5432/cdcp_production

# --- Redis (ElastiCache Cluster Mode) ---
REDIS_URL=redis://master.cdcp-production-redis.xxxxx.cache.amazonaws.com:6379
REDIS_HOST=master.cdcp-production-redis.xxxxx.cache.amazonaws.com
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_ME_REDIS_PASSWORD
REDIS_TLS=true
REDIS_CLUSTER_MODE=true

# --- AWS Services ---
AWS_REGION=ap-northeast-1
AWS_ACCOUNT_ID=123456789012

# S3 Bucket
S3_BUCKET_NAME=cdcp-production-photos
S3_BUCKET_REGION=ap-northeast-1
S3_PUBLIC_URL=https://d9876543210fedcba.cloudfront.net

# ECR
ECR_REPOSITORY=cdcp-production
ECR_IMAGE_TAG=production-20260215-abcdef

# CloudFront
CLOUDFRONT_DISTRIBUTION_ID=E9876543210FED
CLOUDFRONT_DOMAIN=d9876543210fedcba.cloudfront.net

# --- Authentication (Auth0) ---
AUTH0_DOMAIN=cdcp-prod.us.auth0.com
AUTH0_CLIENT_ID=CHANGE_ME_PRODUCTION_CLIENT_ID
AUTH0_CLIENT_SECRET=CHANGE_ME_PRODUCTION_CLIENT_SECRET
AUTH0_AUDIENCE=https://api.cdcp.example.com
AUTH0_CALLBACK_URL=https://cdcp.example.com/callback
AUTH0_LOGOUT_URL=https://cdcp.example.com
AUTH0_MFA_REQUIRED=true  # 本番環境はMFA必須

# JWT
JWT_SECRET=CHANGE_ME_CRYPTOGRAPHICALLY_SECURE_RANDOM_STRING_128_CHARS_MIN
JWT_EXPIRATION=24h
JWT_ALGORITHM=HS256
JWT_REFRESH_SECRET=CHANGE_ME_DIFFERENT_CRYPTOGRAPHICALLY_SECURE_RANDOM_STRING_128_CHARS_MIN
JWT_REFRESH_EXPIRATION=7d

# --- Monitoring & Logging ---

# Datadog
DATADOG_API_KEY=CHANGE_ME_PRODUCTION_API_KEY
DATADOG_APP_KEY=CHANGE_ME_PRODUCTION_APP_KEY
DATADOG_SITE=datadoghq.com
DATADOG_ENV=production
DATADOG_SERVICE=cdcp-api
DATADOG_VERSION=1.0.0

# Sentry
SENTRY_DSN=https://xxxxx@xxxxx.ingest.sentry.io/xxxxx
SENTRY_ENVIRONMENT=production
SENTRY_TRACES_SAMPLE_RATE=0.1  # 本番は10%サンプリング
SENTRY_PROFILES_SAMPLE_RATE=0.1

# CloudWatch
CLOUDWATCH_LOG_GROUP=/ecs/cdcp-production
CLOUDWATCH_LOG_STREAM_PREFIX=api

# --- File Upload ---
MAX_FILE_SIZE=10485760  # 10MB
ALLOWED_FILE_TYPES=image/jpeg,image/png,image/heif,application/pdf

# --- Email (SES) ---
SES_REGION=ap-northeast-1
SES_FROM_EMAIL=noreply@cdcp.example.com
SES_REPLY_TO_EMAIL=support@cdcp.example.com
SES_CONFIGURATION_SET=cdcp-production

# --- Feature Flags ---
FEATURE_GPS_ENABLED=true
FEATURE_OFFLINE_MODE=true
FEATURE_CALS_EC_EXPORT=true
FEATURE_CUSTOMER_PORTAL=false  # Phase3で有効化

# --- Security ---
CORS_ORIGIN=https://cdcp.example.com,https://www.cdcp.example.com
RATE_LIMIT_MAX=100
RATE_LIMIT_WINDOW=60000  # 1分
HELMET_CSP_ENABLED=true
CSRF_PROTECTION_ENABLED=true

# --- Logging ---
LOG_LEVEL=info  # 本番環境はinfoレベル（debugは使わない）
LOG_FORMAT=json
LOG_TIMESTAMP=true
LOG_SAMPLING_RATE=1.0  # 100%ログ出力

# --- Session ---
SESSION_SECRET=CHANGE_ME_CRYPTOGRAPHICALLY_SECURE_RANDOM_STRING_128_CHARS_MIN
SESSION_TIMEOUT=1800000  # 30分（ミリ秒）
SESSION_ABSOLUTE_TIMEOUT=28800000  # 8時間（ミリ秒）

# --- CALS/EC Settings ---
CALS_EC_ENABLED=true
CALS_EC_SCHEMA_VERSION=1.2
CALS_EC_CERTIFICATE_PATH=/secrets/cals-ec-cert.pem
CALS_EC_PRIVATE_KEY_PATH=/secrets/cals-ec-key.pem
CALS_EC_VALIDATION_URL=https://www.cals-ed.go.jp/validate

# --- Backup ---
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # 毎日午前2時
BACKUP_RETENTION_DAYS=90  # 90日保持（監査要件）

# --- Cost Tracking ---
COST_CENTER=production
BILLING_TAG=cdcp-production
BUDGET_ALERT_THRESHOLD=500000  # 月50万円でアラート

# --- Disaster Recovery ---
DR_ENABLED=true
DR_RTO=14400  # 4時間（秒）
DR_RPO=3600  # 1時間（秒）
DR_BACKUP_REGION=ap-northeast-3  # 大阪リージョン
