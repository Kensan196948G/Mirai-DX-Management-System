# ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³é›†

## 1. ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆå›³

```mermaid
graph TB
    subgraph "ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå±¤"
        Mobile["ğŸ“± ãƒ¢ãƒã‚¤ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶<br/>(PWA)"]
        Desktop["ğŸ’» ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãƒ–ãƒ©ã‚¦ã‚¶<br/>(PWA)"]
    end

    subgraph "CDNå±¤"
        CloudFront["â˜ï¸ CloudFront<br/>(é™çš„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é…ä¿¡)"]
    end

    subgraph "ãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µå±¤"
        ALB["âš–ï¸ Application Load Balancer<br/>(HTTPS:443)"]
    end

    subgraph "ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤ (Private Subnet)"
        ECS1["ğŸ³ ECS Fargate Task 1<br/>(NestJS API)"]
        ECS2["ğŸ³ ECS Fargate Task 2<br/>(NestJS API)"]
        ECS3["ğŸ³ ECS Fargate Task N<br/>(Auto Scaling)"]
    end

    subgraph "ãƒ‡ãƒ¼ã‚¿å±¤ (Database Subnet)"
        RDS_Primary["ğŸ—„ï¸ RDS PostgreSQL 15<br/>(Primary)<br/>+ PostGIS"]
        RDS_Standby["ğŸ—„ï¸ RDS PostgreSQL 15<br/>(Standby)<br/>Multi-AZ"]
    end

    subgraph "ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å±¤"
        S3["ğŸ“¦ S3 Bucket<br/>(å†™çœŸãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜)"]
    end

    subgraph "èªè¨¼å±¤"
        Auth0["ğŸ” Auth0<br/>(èªè¨¼ãƒ»èªå¯)"]
    end

    subgraph "ç›£è¦–ãƒ»ãƒ­ã‚°å±¤"
        CloudWatch["ğŸ“Š CloudWatch<br/>(ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ»ãƒ­ã‚°)"]
        Secrets["ğŸ”‘ Secrets Manager<br/>(èªè¨¼æƒ…å ±)"]
    end

    Mobile --> CloudFront
    Desktop --> CloudFront
    CloudFront --> ALB
    ALB --> ECS1
    ALB --> ECS2
    ALB --> ECS3

    ECS1 --> RDS_Primary
    ECS2 --> RDS_Primary
    ECS3 --> RDS_Primary

    RDS_Primary -.åŒæœŸ.- RDS_Standby

    ECS1 --> S3
    ECS2 --> S3
    ECS3 --> S3

    S3 --> CloudFront

    Mobile -.èªè¨¼.- Auth0
    Desktop -.èªè¨¼.- Auth0
    ECS1 -.æ¤œè¨¼.- Auth0
    ECS2 -.æ¤œè¨¼.- Auth0
    ECS3 -.æ¤œè¨¼.- Auth0

    ECS1 -.ãƒ­ã‚°.- CloudWatch
    ECS2 -.ãƒ­ã‚°.- CloudWatch
    ECS3 -.ãƒ­ã‚°.- CloudWatch

    ECS1 -.ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå–å¾—.- Secrets
    ECS2 -.ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå–å¾—.- Secrets
    ECS3 -.ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆå–å¾—.- Secrets

    style Mobile fill:#e1f5ff
    style Desktop fill:#e1f5ff
    style CloudFront fill:#ff9900
    style ALB fill:#ff9900
    style ECS1 fill:#ff9900
    style ECS2 fill:#ff9900
    style ECS3 fill:#ff9900
    style RDS_Primary fill:#527fff
    style RDS_Standby fill:#527fff
    style S3 fill:#569a31
    style Auth0 fill:#eb5424
    style CloudWatch fill:#ff9900
    style Secrets fill:#ff9900
```

---

## 2. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆå›³ (VPC)

```mermaid
graph TB
    subgraph "ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ"
        Internet["ğŸŒ Internet Gateway"]
    end

    subgraph "CDCP VPC (10.0.0.0/16)"
        subgraph "Public Subnet A (10.0.1.0/24) - AZ-a"
            ALB_A["ALB"]
            NAT_A["NAT Gateway A"]
        end

        subgraph "Public Subnet B (10.0.2.0/24) - AZ-c"
            ALB_B["ALB"]
            NAT_B["NAT Gateway B"]
        end

        subgraph "Private Subnet A (10.0.11.0/24) - AZ-a"
            ECS_A["ECS Fargate<br/>Task"]
            VPC_EP_A["VPC Endpoint<br/>(S3, ECR, Logs)"]
        end

        subgraph "Private Subnet B (10.0.12.0/24) - AZ-c"
            ECS_B["ECS Fargate<br/>Task"]
            VPC_EP_B["VPC Endpoint<br/>(S3, ECR, Logs)"]
        end

        subgraph "Database Subnet A (10.0.21.0/24) - AZ-a"
            RDS_A["RDS Primary"]
        end

        subgraph "Database Subnet B (10.0.22.0/24) - AZ-c"
            RDS_B["RDS Standby"]
        end
    end

    Internet --> ALB_A
    Internet --> ALB_B

    ALB_A --> ECS_A
    ALB_B --> ECS_B

    ECS_A --> NAT_A
    ECS_B --> NAT_B

    NAT_A --> Internet
    NAT_B --> Internet

    ECS_A --> VPC_EP_A
    ECS_B --> VPC_EP_B

    ECS_A --> RDS_A
    ECS_B --> RDS_A

    RDS_A -.åŒæœŸ.- RDS_B

    style Internet fill:#e1f5ff
    style ALB_A fill:#ff9900
    style ALB_B fill:#ff9900
    style NAT_A fill:#ff9900
    style NAT_B fill:#ff9900
    style ECS_A fill:#ff9900
    style ECS_B fill:#ff9900
    style VPC_EP_A fill:#ff9900
    style VPC_EP_B fill:#ff9900
    style RDS_A fill:#527fff
    style RDS_B fill:#527fff
```

---

## 3. ãƒ¢ãƒãƒ¬ãƒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ å›³

```mermaid
graph TB
    Root["ğŸ“¦ cdcp-monorepo<br/>(Turborepo)"]

    Root --> Apps["ğŸ“ apps/"]
    Root --> Packages["ğŸ“ packages/"]
    Root --> Infra["ğŸ“ infrastructure/"]
    Root --> Docs["ğŸ“ docs/"]

    Apps --> API["ğŸš€ api/<br/>(NestJS)"]
    Apps --> Web["ğŸŒ web/<br/>(React PWA)"]

    Packages --> Shared_Types["ğŸ“˜ @cdcp/shared-types<br/>(TypeScriptå‹å®šç¾©)"]
    Packages --> Shared_Utils["ğŸ”§ @cdcp/shared-utils<br/>(å…±é€šãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£)"]
    Packages --> Shared_Constants["ğŸ“‹ @cdcp/shared-constants<br/>(å®šæ•°å®šç¾©)"]
    Packages --> UI["ğŸ¨ @cdcp/ui<br/>(shadcn/ui)"]
    Packages --> Prisma["ğŸ—„ï¸ @cdcp/prisma<br/>(DB Schema)"]

    Infra --> Terraform["ğŸ—ï¸ terraform/<br/>(IaC)"]
    Infra --> Docker["ğŸ³ docker/<br/>(Dockerfile)"]

    API --> Shared_Types
    API --> Shared_Utils
    API --> Shared_Constants
    API --> Prisma

    Web --> Shared_Types
    Web --> Shared_Utils
    Web --> Shared_Constants
    Web --> UI

    style Root fill:#4a90e2
    style Apps fill:#7ed321
    style Packages fill:#f5a623
    style Infra fill:#bd10e0
    style API fill:#50e3c2
    style Web fill:#50e3c2
    style Shared_Types fill:#f8e71c
    style Shared_Utils fill:#f8e71c
    style Shared_Constants fill:#f8e71c
    style UI fill:#f8e71c
    style Prisma fill:#f8e71c
    style Terraform fill:#d0021b
    style Docker fill:#d0021b
```

---

## 4. NestJS ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ (4å±¤æ§‹é€ )

```mermaid
graph TB
    subgraph "Presentation Layer (ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å±¤)"
        Controller["ğŸ“® Controller<br/>(HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†)<br/>photos.controller.ts"]
        Guard["ğŸ›¡ï¸ Guard<br/>(èªè¨¼ãƒ»èªå¯)<br/>auth.guard.ts"]
        Interceptor["ğŸ”„ Interceptor<br/>(ãƒ­ã‚°ãƒ»å¤‰æ›)<br/>logging.interceptor.ts"]
        Pipe["ğŸ”§ Pipe<br/>(ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³)<br/>validation.pipe.ts"]
    end

    subgraph "Application Layer (ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤)"
        UseCase["âš™ï¸ Use Case<br/>(ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯)<br/>upload-photo.usecase.ts"]
        DTO["ğŸ“‹ DTO<br/>(ãƒ‡ãƒ¼ã‚¿è»¢é€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)<br/>create-photo.dto.ts"]
    end

    subgraph "Domain Layer (ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤)"
        Entity["ğŸ§± Entity<br/>(ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ¢ãƒ‡ãƒ«)<br/>photo.entity.ts"]
        Repository["ğŸ“¦ Repository Interface<br/>(æ°¸ç¶šåŒ–æŠ½è±¡)<br/>photo.repository.ts"]
        DomainService["ğŸ¯ Domain Service<br/>(ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ­ã‚¸ãƒƒã‚¯)<br/>photo.service.ts"]
    end

    subgraph "Infrastructure Layer (ã‚¤ãƒ³ãƒ•ãƒ©å±¤)"
        PrismaRepo["ğŸ—„ï¸ Prisma Repository<br/>(DBå®Ÿè£…)<br/>photo-prisma.repository.ts"]
        S3Service["â˜ï¸ S3 Service<br/>(ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸å®Ÿè£…)<br/>storage.service.ts"]
        ExternalAPI["ğŸŒ External API<br/>(å¤–éƒ¨é€£æº)<br/>auth0.service.ts"]
    end

    Controller --> Guard
    Guard --> Interceptor
    Interceptor --> Pipe
    Pipe --> UseCase
    UseCase --> DTO
    DTO --> Entity
    UseCase --> Repository
    Repository --> PrismaRepo
    UseCase --> DomainService
    DomainService --> Entity
    UseCase --> S3Service
    UseCase --> ExternalAPI

    style Controller fill:#e74c3c
    style Guard fill:#e67e22
    style Interceptor fill:#e67e22
    style Pipe fill:#e67e22
    style UseCase fill:#3498db
    style DTO fill:#3498db
    style Entity fill:#2ecc71
    style Repository fill:#2ecc71
    style DomainService fill:#2ecc71
    style PrismaRepo fill:#9b59b6
    style S3Service fill:#9b59b6
    style ExternalAPI fill:#9b59b6
```

---

## 5. Phase1 å†™çœŸç®¡ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾å­˜é–¢ä¿‚å›³

```mermaid
graph TB
    subgraph "Phase1 Core Modules"
        PhotosModule["ğŸ“· PhotosModule<br/>(å†™çœŸç®¡ç†)"]
        ProjectsModule["ğŸ“ ProjectsModule<br/>(æ¡ˆä»¶ç®¡ç†)"]
        UsersModule["ğŸ‘¤ UsersModule<br/>(ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†)"]
        AuthModule["ğŸ” AuthModule<br/>(èªè¨¼)"]
        StorageModule["â˜ï¸ StorageModule<br/>(S3ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸)"]
    end

    subgraph "Common Modules"
        DatabaseModule["ğŸ—„ï¸ DatabaseModule<br/>(Prisma)"]
        ConfigModule["âš™ï¸ ConfigModule<br/>(ç’°å¢ƒå¤‰æ•°)"]
        LoggerModule["ğŸ“ LoggerModule<br/>(ãƒ­ã‚°)"]
        MetricsModule["ğŸ“Š MetricsModule<br/>(ãƒ¡ãƒˆãƒªã‚¯ã‚¹)"]
    end

    PhotosModule --> ProjectsModule
    PhotosModule --> UsersModule
    PhotosModule --> StorageModule
    PhotosModule --> DatabaseModule

    ProjectsModule --> UsersModule
    ProjectsModule --> DatabaseModule

    UsersModule --> AuthModule
    UsersModule --> DatabaseModule

    AuthModule --> ConfigModule

    StorageModule --> ConfigModule
    StorageModule --> LoggerModule

    DatabaseModule --> ConfigModule

    MetricsModule --> ConfigModule

    style PhotosModule fill:#e74c3c
    style ProjectsModule fill:#3498db
    style UsersModule fill:#2ecc71
    style AuthModule fill:#f39c12
    style StorageModule fill:#9b59b6
    style DatabaseModule fill:#34495e
    style ConfigModule fill:#95a5a6
    style LoggerModule fill:#95a5a6
    style MetricsModule fill:#95a5a6
```

---

## 6. React PWA ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ çŠ¶æ…‹ç®¡ç†ãƒ•ãƒ­ãƒ¼

```mermaid
graph TB
    subgraph "UI Components"
        PhotoList["ğŸ“· PhotoList"]
        PhotoCard["ğŸ–¼ï¸ PhotoCard"]
        PhotoUploader["â¬†ï¸ PhotoUploader"]
    end

    subgraph "Custom Hooks"
        usePhotos["ğŸª usePhotos()<br/>(React Query)"]
        usePhotoUpload["ğŸª usePhotoUpload()<br/>(React Query Mutation)"]
        usePhotoStore["ğŸª usePhotoStore()<br/>(Zustand)"]
        useOfflineSync["ğŸª useOfflineSync()"]
    end

    subgraph "State Management"
        ReactQuery["âš¡ React Query<br/>(ã‚µãƒ¼ãƒãƒ¼çŠ¶æ…‹)"]
        Zustand["ğŸ» Zustand<br/>(ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹)"]
        IndexedDB["ğŸ’¾ IndexedDB<br/>(ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿)"]
    end

    subgraph "API Layer"
        APIClient["ğŸŒ API Client<br/>(Axios)"]
    end

    subgraph "Service Worker"
        SW["âš™ï¸ Service Worker<br/>(Workbox)"]
        Cache["ğŸ“¦ Cache Storage"]
    end

    PhotoList --> usePhotos
    PhotoCard --> usePhotoStore
    PhotoUploader --> usePhotoUpload

    usePhotos --> ReactQuery
    usePhotoUpload --> ReactQuery
    usePhotoStore --> Zustand
    useOfflineSync --> IndexedDB

    ReactQuery --> APIClient
    APIClient --> SW
    SW --> Cache

    usePhotoUpload -.ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚.- IndexedDB
    IndexedDB -.åŒæœŸ.- APIClient

    style PhotoList fill:#61dafb
    style PhotoCard fill:#61dafb
    style PhotoUploader fill:#61dafb
    style usePhotos fill:#764abc
    style usePhotoUpload fill:#764abc
    style usePhotoStore fill:#764abc
    style useOfflineSync fill:#764abc
    style ReactQuery fill:#ff4154
    style Zustand fill:#42b883
    style IndexedDB fill:#3498db
    style APIClient fill:#2ecc71
    style SW fill:#9b59b6
    style Cache fill:#e67e22
```

---

## 7. å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³

```mermaid
sequenceDiagram
    participant User as ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant PWA as ğŸ“± PWA (React)
    participant SW as âš™ï¸ Service Worker
    participant IndexedDB as ğŸ’¾ IndexedDB
    participant API as ğŸš€ API (NestJS)
    participant S3 as ğŸ“¦ S3
    participant RDS as ğŸ—„ï¸ RDS

    User->>PWA: ã‚«ãƒ¡ãƒ©ã§æ’®å½±
    PWA->>PWA: GPSä½ç½®æƒ…å ±å–å¾—
    PWA->>PWA: Web Worker ã§ç”»åƒåœ§ç¸®

    alt ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚
        PWA->>API: POST /photos (multipart/form-data)
        API->>API: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        API->>S3: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        S3-->>API: ç”»åƒURL
        API->>RDS: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        RDS-->>API: Photo ID
        API-->>PWA: 200 OK (Photo Data)
        PWA->>IndexedDB: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¿å­˜
        PWA-->>User: âœ… ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æˆåŠŸ
    else ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚
        PWA->>IndexedDB: Pending Upload ã¨ã—ã¦ä¿å­˜
        PWA-->>User: â³ ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ä¿å­˜å®Œäº†

        Note over PWA,IndexedDB: ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°å¾Œ
        SW->>IndexedDB: Pending Upload å–å¾—
        SW->>API: POST /photos (ãƒªãƒˆãƒ©ã‚¤)
        API->>S3: ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
        S3-->>API: ç”»åƒURL
        API->>RDS: ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        RDS-->>API: Photo ID
        API-->>SW: 200 OK
        SW->>IndexedDB: Pending å‰Šé™¤
        SW-->>User: ğŸ”” åŒæœŸå®Œäº†é€šçŸ¥
    end
```

---

## 8. CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å›³

```mermaid
graph LR
    subgraph "Source"
        GitHub["ğŸ“‚ GitHub<br/>(main branch)"]
    end

    subgraph "Build"
        CodeBuild["ğŸ—ï¸ CodeBuild<br/>(Docker Build)"]
        ECR["ğŸ“¦ ECR<br/>(Container Registry)"]
    end

    subgraph "Deploy"
        ECS["ğŸ³ ECS Fargate<br/>(Blue/Green Deploy)"]
    end

    subgraph "Test"
        E2E["ğŸ§ª E2E Test<br/>(Playwright)"]
        HealthCheck["â¤ï¸ Health Check"]
    end

    GitHub -->|Push| CodeBuild
    CodeBuild -->|Build & Push| ECR
    ECR -->|Pull Image| ECS
    ECS -->|Run Tests| E2E
    E2E -->|Pass| HealthCheck
    HealthCheck -->|Success| ECS
    HealthCheck -->|Fail| CodeBuild

    style GitHub fill:#24292e
    style CodeBuild fill:#ff9900
    style ECR fill:#ff9900
    style ECS fill:#ff9900
    style E2E fill:#2ecc71
    style HealthCheck fill:#e74c3c
```

---

## 9. èªè¨¼ãƒ»èªå¯ãƒ•ãƒ­ãƒ¼å›³

```mermaid
sequenceDiagram
    participant User as ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼
    participant PWA as ğŸ“± PWA
    participant Auth0 as ğŸ” Auth0
    participant API as ğŸš€ API
    participant RDS as ğŸ—„ï¸ RDS

    User->>PWA: ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    PWA->>Auth0: OAuth2 èªè¨¼ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
    Auth0-->>User: ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢è¡¨ç¤º
    User->>Auth0: èªè¨¼æƒ…å ±å…¥åŠ›
    Auth0->>Auth0: èªè¨¼å‡¦ç†
    Auth0-->>PWA: Access Token + ID Token
    PWA->>PWA: Token ã‚’ localStorage ã«ä¿å­˜

    Note over PWA,API: API ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚
    PWA->>API: GET /photos<br/>Authorization: Bearer {token}
    API->>API: JWT æ¤œè¨¼
    API->>Auth0: Token æ¤œè¨¼
    Auth0-->>API: âœ… Valid
    API->>API: æ¨©é™ãƒã‚§ãƒƒã‚¯ (RBAC)
    API->>RDS: ãƒ‡ãƒ¼ã‚¿å–å¾—
    RDS-->>API: Photos
    API-->>PWA: 200 OK (Photos)
    PWA-->>User: å†™çœŸä¸€è¦§è¡¨ç¤º

    Note over PWA,Auth0: Token æœ‰åŠ¹æœŸé™åˆ‡ã‚Œæ™‚
    PWA->>Auth0: Refresh Token ã§ãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–°
    Auth0-->>PWA: æ–°ã—ã„ Access Token
    PWA->>PWA: Token æ›´æ–°
```

---

## 10. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ER å›³ (Phase1 ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«)

```mermaid
erDiagram
    users ||--o{ projects : "creates"
    users ||--o{ photos : "uploads"
    projects ||--o{ photos : "contains"
    projects ||--o{ project_members : "has"
    users ||--o{ project_members : "joins"

    users {
        uuid id PK
        string email UK
        string name
        string role
        timestamp created_at
        timestamp updated_at
    }

    projects {
        uuid id PK
        string name
        string code UK
        text description
        uuid created_by FK
        timestamp start_date
        timestamp end_date
        timestamp created_at
        timestamp updated_at
    }

    photos {
        uuid id PK
        uuid project_id FK
        uuid uploaded_by FK
        string s3_key
        string thumbnail_url
        text description
        decimal latitude
        decimal longitude
        timestamp captured_at
        jsonb exif_data
        timestamp created_at
        timestamp updated_at
    }

    project_members {
        uuid id PK
        uuid project_id FK
        uuid user_id FK
        string role
        timestamp joined_at
    }
```

---

## 11. ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åŒæœŸæˆ¦ç•¥å›³

```mermaid
graph TB
    subgraph "ã‚ªãƒ³ãƒ©ã‚¤ãƒ³æ™‚"
        Online_API["ğŸŒ API é€šä¿¡"]
        Online_IndexedDB["ğŸ’¾ IndexedDB ã‚­ãƒ£ãƒƒã‚·ãƒ¥"]
        Online_SW["âš™ï¸ Service Worker ã‚­ãƒ£ãƒƒã‚·ãƒ¥"]
    end

    subgraph "ã‚ªãƒ•ãƒ©ã‚¤ãƒ³æ™‚"
        Offline_IndexedDB["ğŸ’¾ IndexedDB<br/>(Pending Queue)"]
        Offline_UI["ğŸ“± UI å³åº§ã«æ›´æ–°<br/>(Optimistic Update)"]
    end

    subgraph "ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¾©å¸°æ™‚"
        Sync_Check["ğŸ”„ Pending Queue ãƒã‚§ãƒƒã‚¯"]
        Sync_Upload["â¬†ï¸ ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰åŒæœŸ"]
        Sync_Success["âœ… åŒæœŸå®Œäº†<br/>(Queue ã‹ã‚‰å‰Šé™¤)"]
        Sync_Retry["ğŸ” ãƒªãƒˆãƒ©ã‚¤<br/>(æœ€å¤§3å›)"]
    end

    Online_API --> Online_IndexedDB
    Online_API --> Online_SW

    Offline_UI --> Offline_IndexedDB

    Sync_Check --> Sync_Upload
    Sync_Upload -->|æˆåŠŸ| Sync_Success
    Sync_Upload -->|å¤±æ•—| Sync_Retry
    Sync_Retry -->|3å›å¤±æ•—| Offline_IndexedDB

    style Online_API fill:#2ecc71
    style Online_IndexedDB fill:#3498db
    style Online_SW fill:#9b59b6
    style Offline_IndexedDB fill:#e67e22
    style Offline_UI fill:#e74c3c
    style Sync_Check fill:#f39c12
    style Sync_Upload fill:#1abc9c
    style Sync_Success fill:#27ae60
    style Sync_Retry fill:#e74c3c
```

---

## 12. ã¾ã¨ã‚

æœ¬ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€CDCP ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ Phase1 ã«ãŠã‘ã‚‹ä»¥ä¸‹ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ã‚’æä¾›ã—ãŸã€‚

| # | å›³ã®ç¨®é¡ | ç›®çš„ |
|---|---------|------|
| 1 | ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆå›³ | AWS ã‚µãƒ¼ãƒ“ã‚¹ã¨ã®çµ±åˆå…¨ä½“åƒ |
| 2 | ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ§‹æˆå›³ (VPC) | Multi-AZ å†—é•·æ§‹æˆ |
| 3 | ãƒ¢ãƒãƒ¬ãƒ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ å›³ | Turborepo æ§‹æˆ |
| 4 | NestJS 4å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ | ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è²¬å‹™åˆ†é›¢ |
| 5 | Phase1 ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾å­˜é–¢ä¿‚å›³ | å¾ªç’°ä¾å­˜é˜²æ­¢ |
| 6 | React PWA çŠ¶æ…‹ç®¡ç†ãƒ•ãƒ­ãƒ¼ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆçŠ¶æ…‹ç®¡ç†æˆ¦ç•¥ |
| 7 | å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ ã‚·ãƒ¼ã‚±ãƒ³ã‚¹å›³ | ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ãƒ»ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ |
| 8 | CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å›³ | è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼ |
| 9 | èªè¨¼ãƒ»èªå¯ãƒ•ãƒ­ãƒ¼å›³ | Auth0 çµ±åˆ |
| 10 | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ ER å›³ | Phase1 ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ« |
| 11 | ã‚ªãƒ•ãƒ©ã‚¤ãƒ³åŒæœŸæˆ¦ç•¥å›³ | PWA ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å¯¾å¿œ |

ã“ã‚Œã‚‰ã®å›³ã¯ã€é–‹ç™ºãƒãƒ¼ãƒ å…¨ä½“ã§ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ç†è§£ã‚’ä¿ƒé€²ã—ã€å®Ÿè£…æ™‚ã®æŒ‡é‡ã¨ãªã‚‹ã€‚

---

**ä½œæˆæ—¥**: 2026-02-15
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0
**ä½œæˆè€…**: Architecture Review Agent
