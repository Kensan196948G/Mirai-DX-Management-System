# 運用マニュアル (Operations Manual)

**バージョン:** 1.0
**最終更新日:** 2026年2月15日
**対象システム:** Mirai DX Management System
**運用体制:** IT部門 5名体制

---

## 1. はじめに

本ドキュメントは、Mirai DX Management System（以下「本システム」）の日常的な運用業務を円滑に実施するためのマニュアルです。IT部門5名での運用を想定し、日次・週次・月次の各業務および定期的な保守作業の手順を定義します。

---

## 2. 運用組織と責任分担

### 2.1 運用体制

| 役割 | 人数 | 主な責務 |
|------|------|--------|
| **運用管理者** | 1名 | 全体統括、スケジューリング、ベンダー調整 |
| **主務運用エンジニア** | 2名 | 日次監視、アラート対応、定期メンテナンス |
| **副務運用エンジニア** | 1名 | バックアップ管理、ログ分析、ドキュメント更新 |
| **セキュリティ担当** | 1名 | セキュリティ監視、アクセス管理、監査対応 |

### 2.2 連絡先と対応時間

- **営業時間対応:** 月～金 9:00～17:30
- **夜間・休日対応:** 緊急時のみ（障害レベル1～2）
- **マネージドサービス利用:** AWS Systems Manager / New Relic / Datadog等との連携

---

## 3. 日次運用業務

### 3.1 朝礼（毎日 9:00）

**実施者:** 運用管理者 + 主務運用エンジニア
**所要時間:** 15分

#### 実施内容

1. **前日からの持ち越し案件確認**
   - 未解決アラートの確認
   - 進行中の作業状況

2. **本日のスケジュール確認**
   - 定期メンテナンス予定
   - ユーザーからの要件確認
   - 外部ベンダー作業予定

3. **システムヘルスチェック（簡易版）**
   - サービス稼働状況
   - リソース使用率（CPU、メモリ、ディスク）
   - エラーログ発生件数

### 3.2 監視ダッシュボード確認（毎日 9:30、12:30、16:30）

**実施者:** 主務運用エンジニア
**監視対象:**

| 監視項目 | 正常値 | 警告閾値 | 異常閾値 |
|---------|-------|--------|---------|
| **CPU使用率** | <60% | 70% | 85% |
| **メモリ使用率** | <70% | 80% | 90% |
| **ディスク使用率** | <70% | 80% | 90% |
| **応答時間** | <500ms | 1000ms | 2000ms |
| **エラー率** | <1% | 3% | 5% |
| **DB接続数** | <100 | 150 | 200 |

**確認方法:**
```
1. 監視ツール（New Relic/Datadog）にアクセス
2. ダッシュボード > System Health を開く
3. 上記の指標を確認
4. 警告閾値を超えた場合は、4.1項の対応を実施
```

### 3.3 ログレビュー（毎日 17:00）

**実施者:** 副務運用エンジニア
**対象ログ:**
- アプリケーションエラーログ
- データベースエラーログ
- セキュリティログ

**確認手順:**

```bash
# システムエラーログの確認（最直近100件）
tail -n 100 /var/log/mirai-dx/application.log | grep -i error

# DB関連エラーの確認
grep -i "database\|connection" /var/log/mirai-dx/db.log | tail -n 50

# セキュリティ関連イベント
grep -i "auth\|permission\|denied" /var/log/mirai-dx/security.log | tail -n 50
```

**異常検出時の対応:**
- 同一エラーが連続している場合は、障害対応手順書を参照
- ログの日報を副務運用エンジニアが翌朝9:00までに作成

### 3.4 ユーザーサポート時間（毎日 10:00～11:00, 14:00～15:00）

**実施者:** 運用管理者 + 主務運用エンジニア（1名）
**対応内容:**
- ユーザーからの問い合わせ対応
- 軽微な設定変更
- アカウント管理

**対応手順:**
1. チケットシステムで受信
2. 優先度・複雑度を判定
3. 30分以内に回答するか、詳細調査予定を案内
4. チケットシステムに対応履歴を記録

---

## 4. 週次運用業務

### 4.1 週次定例会議（毎週月曜 10:00）

**実施者:** IT部門 全員
**所要時間:** 60分

#### アジェンダ

1. **先週の実績レビュー** (15分)
   - 発生した障害・インシデント
   - 対応時間・解決時間
   - 利用可能性（Availability）

2. **今週の計画確認** (15分)
   - 定期メンテナンス予定
   - ベンダー作業予定
   - ユーザー要望への対応予定

3. **技術課題討議** (20分)
   - パフォーマンス課題
   - セキュリティ脅威
   - インフラリソース不足の予測

4. **改善案提案** (10分)
   - 各自から改善案を募集
   - 優先度判定と実施予定

### 4.2 ストレージ容量確認

**実施者:** 副務運用エンジニア
**実施日:** 毎週木曜 10:00

#### ディスク使用量の確認

```bash
# 全ディスクの使用状況
df -h

# 各マウントポイントの容量確認
du -sh /* | sort -rh | head -20

# ログディレクトリの容量
du -sh /var/log/mirai-dx/*

# データベースデータファイルの容量
du -sh /var/lib/mysql/* 2>/dev/null || du -sh /var/lib/postgresql/*
```

#### 対応基準

| 使用率 | 対応内容 |
|--------|---------|
| <70% | 対応不要（記録のみ） |
| 70%～80% | ログアーカイブ・不要ファイル削除検討 |
| 80%～90% | 緊急でアーカイブ実施、容量増設計画開始 |
| >90% | **直ちに対応**、増設手配、ユーザー新規投稿制限検討 |

### 4.3 バックアップリスト確認

**実施者:** 副務運用エンジニア
**実施日:** 毎週木曜 14:00

```bash
# バックアップジョブの実行状況確認
ls -lh /backup/mirai-dx-backups/ | tail -n 20

# 最直近バックアップのサイズと日時
stat /backup/mirai-dx-backups/latest/

# バックアップログのエラーチェック
grep -i "error\|failed" /var/log/backup/mirai-dx-backup.log | tail -n 20
```

**確認項目:**
- ✓ 毎日のバックアップが実行されているか
- ✓ バックアップサイズは想定範囲内か
- ✓ 増分バックアップは機能しているか
- ✓ エラーログに異常は無いか

### 4.4 セキュリティスキャン実施

**実施者:** セキュリティ担当
**実施日:** 毎週金曜 15:00

```bash
# 定義されたセキュリティスキャン実行
/usr/local/bin/security-scan.sh --full --report

# ログイン失敗の多い IPアドレスを確認
grep "authentication failed" /var/log/auth.log | awk '{print $NF}' | sort | uniq -c | sort -rn | head -10

# 未認可アクセス試行の確認
grep -i "unauthorized\|forbidden" /var/log/mirai-dx/access.log | wc -l
```

**報告内容:**
- 検出された脆弱性
- 疑わしいアクセスパターン
- パッチ適用推奨事項

---

## 5. 月次運用業務

### 5.1 月次運用会議（毎月第1月曜 9:00）

**実施者:** IT部門 全員 + 経営層（オプション）
**所要時間:** 90分

#### アジェンダ

1. **月間パフォーマンスレビュー** (30分)
   - 利用可能性（Availability）
   - 平均応答時間
   - エラー率
   - インシデント統計

2. **KPI報告** (15分)
   - Mean Time To Recovery (MTTR)
   - Mean Time Between Failures (MTBF)
   - 年間稼働率

3. **コスト分析** (15分)
   - インフラコスト
   - マネージドサービス利用料
   - ベンダー支払い

4. **改善実績と今月の課題** (20分)
   - 先月の改善項目の効果測定
   - 今月の改善優先度決定

5. **来月の計画確認** (10分)
   - メンテナンススケジュール
   - リリース予定
   - ベンダー作業予定

### 5.2 月次パフォーマンスレポート作成

**実施者:** 運用管理者
**実施日:** 毎月3日

#### レポートに含める内容

```markdown
## Mirai DX Management System - 月次運用レポート

### 1. サマリー
- 稼働時間: __時間 (__%)
- 発生インシデント: __件
- 平均対応時間: __分

### 2. システムパフォーマンス
| 指標 | 当月 | 先月 | 目標値 |
|------|------|------|--------|
| 稼働率 | | | 99.5% |
| 平均応答時間 | | | <500ms |
| エラー率 | | | <1% |

### 3. インシデント分析
- 件数: __件
- レベル1: __件
- レベル2: __件
- レベル3: __件

### 4. バックアップ実績
- 成功: __回 / 実施予定: __回
- リストア成功: __回 / テスト実施: __回

### 5. セキュリティ
- 脆弱性検出: __件
- パッチ適用: __件
- 不正アクセス試行: __件

### 6. コスト
- インフラ: ¥__
- マネージドサービス: ¥__
- その他: ¥__
- **合計: ¥__**

### 7. 改善実績
- 実装完了: __件
- 実施中: __件
- 計画中: __件

### 8. 来月の重点施策
- [ ] 項目1
- [ ] 項目2
- [ ] 項目3
```

### 5.3 ユーザーアカウント監査

**実施者:** セキュリティ担当
**実施日:** 毎月第2金曜

```bash
# 全ユーザーアカウント一覧
select user_id, username, email, role, created_at, last_login_at
  from users
  order by last_login_at desc;

# 非アクティブユーザー確認（90日未ログイン）
select user_id, username, email, last_login_at,
       DATEDIFF(NOW(), last_login_at) as days_inactive
  from users
  where last_login_at < DATE_SUB(NOW(), INTERVAL 90 DAY)
  order by last_login_at desc;

# 管理者権限ユーザー確認
select user_id, username, email, role, created_at
  from users
  where role = 'admin' or role = 'system_admin'
  order by created_at desc;
```

**対応:**
- 非アクティブユーザーへの連絡確認
- 不要なアカウント削除承認申請
- 権限変更の正当性確認

### 5.4 容量計画レビュー

**実施者:** 副務運用エンジニア
**実施日:** 毎月最終金曜

#### 予測計算

```bash
# 過去3ヶ月のディスク成長率を算出
# 成長率 = (当月 - 3ヶ月前) / 3 / (3ヶ月前) * 100

# 例: 直近のディスク使用率トレンド
echo "Date, Usage(GB)" > /tmp/disk_trend.csv
for month in {1..12}; do
  date=$(date -d "-$month months" +%Y-%m)
  usage=$(grep "^$date" /var/log/disk_usage.log | tail -1 | awk '{print $2}')
  echo "$date, $usage" >> /tmp/disk_trend.csv
done
```

**判定基準:**
- 増設まで **90日以上** 余裕がある → 問題なし
- 増設まで **30～90日** の余裕 → 来月検討開始
- 増設まで **30日未満** → 直ちに増設手配

---

## 6. バックアップ確認手順

### 6.1 バックアップ戦略

| バックアップ種別 | 頻度 | 保持期間 | 保存場所 |
|-----------------|------|---------|---------|
| **フル・増分バックアップ** | 毎日 23:00 | 7日間 | ローカルストレージ |
| **週次フルバックアップ** | 毎週日曜 23:00 | 4週間 | 外部ストレージ |
| **月次フルバックアップ** | 毎月1日 23:00 | 12ヶ月 | クラウドストレージ |

### 6.2 日次バックアップ確認

**実施者:** 副務運用エンジニア
**実施時刻:** 毎日 08:00（バックアップ完了後）

```bash
# バックアップ実行ログの確認
tail -n 50 /var/log/backup/mirai-dx-backup.log

# 期待される出力パターン
# [2026-02-15 23:00:01] Backup started
# [2026-02-15 23:15:30] Database backup completed
# [2026-02-15 23:25:45] File backup completed
# [2026-02-15 23:30:00] Backup completed successfully

# エラーがないことを確認
grep -i "error\|failed\|aborted" /var/log/backup/mirai-dx-backup.log
# 出力がない場合は正常

# バックアップファイルサイズの確認
ls -lh /backup/mirai-dx-backups/daily/ | tail -n 5
```

**正常判定:**
- ✓ ログに "completed successfully" の文字列がある
- ✓ 前日のバックアップファイルが存在する
- ✓ ファイルサイズが想定範囲内（±20%）
- ✓ エラーメッセージがない

### 6.3 バックアップリストア テスト

**実施者:** 副務運用エンジニア
**実施頻度:** 月1回（毎月第2木曜）

#### テスト手順

```bash
# テスト用ディレクトリの準備
mkdir -p /backup/restore_test/$(date +%Y%m%d)
cd /backup/restore_test/$(date +%Y%m%d)

# 最直近バックアップファイルの確認
BACKUP_FILE=$(ls -t /backup/mirai-dx-backups/daily/*.tar.gz | head -1)
echo "Testing backup file: $BACKUP_FILE"

# リストア実行
tar -xzf $BACKUP_FILE -C ./

# リストアされたファイルの整合性確認
# データベースバックアップの確認
if [ -f ./database/dump.sql ]; then
  echo "Database dump found - OK"
  wc -l ./database/dump.sql
else
  echo "ERROR: Database dump not found"
  exit 1
fi

# アプリケーションファイルの確認
if [ -f ./app/config.yml ]; then
  echo "Application config found - OK"
else
  echo "ERROR: Application config not found"
  exit 1
fi

# テスト結果を記録
echo "Backup restore test completed at $(date)" >> /var/log/backup/restore_test.log
```

**テスト結果の判定:**
- ✓ すべてのファイルが正常にリストアされた
- ✓ ファイルが破損していない
- ✓ メタデータが保持されている

### 6.4 異地バックアップ確認

**実施者:** 副務運用エンジニア
**実施頻度:** 月1回（毎月第3木曜）

```bash
# クラウドストレージへのアップロード確認
aws s3 ls s3://mirai-dx-backups/monthly/ --recursive

# 転送ログの確認
tail -n 20 /var/log/backup/s3-sync.log

# 転送スピード・成功率の確認
grep -i "transferred\|failed" /var/log/backup/s3-sync.log | tail -n 5
```

---

## 7. 監視アラート対応

### 7.1 アラート分類

| レベル | 対応時間 | 対応内容 | 通知 |
|--------|---------|--------|------|
| **Critical** | 15分 | 直ちに主務運用エンジニアが対応 | Slack/電話 |
| **Warning** | 1時間 | 朝礼で確認、本日中に対応 | Slack |
| **Info** | 翌営業日 | ログレビュー時に確認 | メール |

### 7.2 アラート受信時の対応フロー

```
1. アラート受信 (Slack/Email/SMS)
   ↓
2. Slack にて直ちに状況確認
   /alert status <alert_id>
   ↓
3. 主務運用エンジニアが1名現場対応開始
   - ダッシュボードで詳細確認
   - ログで原因を確認
   ↓
4. 30分以内に状況をスラックで報告
   ↓
5. 初期対応で解決したか？
   └─ YES → アラートクローズ、日報記録
   └─ NO → 運用管理者に報告、障害対応手順書へ
```

### 7.3 主要なアラートと対応

#### 高CPU使用率アラート (>85%)

```bash
# 1. CPU使用率の確認
top -b -n 1 | head -20

# 2. プロセス別CPU使用率確認
ps aux --sort=-%cpu | head -15

# 3. 該当プロセスの詳細確認
ps -p <PID> -o pid,user,cmd,etime,%cpu,%mem
```

**対応:**
- クエリの最適化提案（開発チーム）
- インデックス追加検討
- リソース追加の検討

#### 高メモリ使用率アラート (>90%)

```bash
# 1. メモリ使用率の確認
free -h

# 2. プロセス別メモリ使用率
ps aux --sort=-%mem | head -15

# 3. メモリリーク確認（Javaアプリの場合）
jmap -heap <PID>
```

**対応:**
- メモリリークの検査
- アプリケーション再起動の検討
- メモリ追加の検討

#### ディスク使用率アラート (>90%)

```bash
# 1. パーティション別使用率
df -h

# 2. ディレクトリ別使用率
du -sh /* | sort -rh | head -20

# 3. ログディレクトリ確認
du -sh /var/log/* | sort -rh
```

**対応手順:**
```bash
# ステップ1: 古いログのアーカイブ
find /var/log/mirai-dx -name "*.log.*" -mtime +30 -delete

# ステップ2: ディスク使用率を再確認
df -h

# ステップ3: まだ>85%の場合は緊急増設手配
```

#### データベース応答時間アラート (>2000ms)

```bash
# 1. DB接続状況確認
mysql -u root -p -e "SHOW PROCESSLIST;"

# 2. 遅いクエリログを確認
tail -n 50 /var/log/mysql/slow-query.log

# 3. テーブルの統計情報更新
mysql -u root -p -e "ANALYZE TABLE <table_name>;"
```

---

## 8. ユーザーサポート手順

### 8.1 サポートチケット処理フロー

```
チケット受信
   ↓
優先度・複雑度判定（5分以内）
   ↓
┌─ 緊急 (30分以内対応)
│   ├─ 当番エンジニアが直ちに対応
│   └─ 対応内容をチケットに記録
│
├─ 高 (2時間以内対応)
│   ├─ 本日中に対応
│   └─ 詳細調査が必要な場合は予定を案内
│
└─ 中・低 (翌営業日対応)
    └─ 優先度順にスケジューリング

解決 → チケットクローズ → 月次レポートに集計
```

### 8.2 よくある問い合わせ対応

#### Q: "ログインできない"

**確認項目:**
```
1. ユーザー ID/パスワードは正しいか
2. Caps Lock は ON になっていないか
3. ブラウザのキャッシュをクリアしたか
4. 別のブラウザで試したか
```

**対応手順:**
```bash
# ユーザーアカウントの確認
select * from users where username = '<username>';

# ユーザーのロック状態確認
select user_id, username, locked, failed_attempts, locked_until
  from users where username = '<username>';

# ロック状態の解除
update users set locked = 0, failed_attempts = 0
  where username = '<username>';
```

#### Q: "データが見つからない"

**確認項目:**
```
1. 検索条件は正しいか
2. フィルタ条件が絞られすぎていないか
3. 権限で閲覧制限されていないか
```

**対応:**
- ユーザーの権限を確認
- データベースで直接クエリ実行して存在確認
- 権限不足の場合は管理者に権限追加を依頼

#### Q: "エクスポートできない"

**確認:**
```bash
# エクスポート機能が正常に動作しているか
curl -X POST http://localhost:8080/api/export/test \
  -H "Authorization: Bearer <token>"

# ファイル容量が大きすぎないか
# メモリ不足のエラーが出ていないか
```

**対応:**
- キャッシュをクリア
- ブラウザを再起動
- 容量が大きい場合は分割エクスポートを提案

---

## 9. FAQ管理

### 9.1 FAQ更新フロー

1. **ユーザーからの質問を集約** (週次)
2. **同じ質問が3件以上** → FAQ候補に追加
3. **運用管理者が内容レビュー** (月2回)
4. **FAQ記事を作成・公開**
5. **ユーザーに周知** (メール/システム内告知)

### 9.2 現在のFAQ例

#### FAQ #1: パスワードリセット方法

**質問:** パスワードを忘れました。どうしたらいいですか？

**回答:**
```
1. ログイン画面の「パスワードをお忘れですか？」をクリック
2. メールアドレスを入力
3. 登録メールアドレスにリセットリンクが送信されます
4. リンクをクリックして新しいパスワードを設定
5. 新しいパスワードでログイン

注: リセットリンクは24時間有効です
```

#### FAQ #2: レポート出力がエラーになる

**質問:** レポート出力時に「メモリ不足」エラーが出ます

**回答:**
```
この場合は以下をお試しください：

1. 出力期間を短縮する
   例: 1ヶ月単位ではなく1週間単位で出力

2. フィルタ条件を絞る
   例: 全店舗ではなく特定店舗のみ

3. ブラウザを再起動して試す

4. 上記でも解決しない場合は、IT部門へお問い合わせください
   連絡先: it-support@company.com
```

#### FAQ #3: 添付ファイルのアップロード失敗

**質問:** 10MBのPDFファイルがアップロードできません

**回答:**
```
ファイルのアップロードには以下の制限があります：

最大ファイルサイズ: 50MB
対応ファイル形式: PDF, Excel, Word, CSV, Image

対応方法：
1. ファイルサイズを圧縮する
2. ブラウザを更新してリトライ
3. 別のブラウザでお試しください

それでも解決しない場合：
IT部門まで、ファイル名と日時を含めてご報告ください
```

---

## 10. チェックリストと記録

### 10.1 日次チェックリスト

```
[ ] 9:00 - 朝礼実施
[ ] 9:30 - 監視ダッシュボード確認
[ ] 10:00-11:00 - ユーザーサポート時間
[ ] 12:30 - 監視ダッシュボード確認
[ ] 14:00-15:00 - ユーザーサポート時間
[ ] 16:30 - 監視ダッシュボード確認
[ ] 17:00 - ログレビュー（副務）
[ ] 18:00 - 当番者に業務引き継ぎ
```

### 10.2 週次チェックリスト

```
月曜
[ ] 9:00 - 朝礼（フル版）
[ ] 10:00 - 週次定例会議

木曜
[ ] 10:00 - ストレージ容量確認
[ ] 14:00 - バックアップリスト確認

金曜
[ ] 15:00 - セキュリティスキャン実施
[ ] 17:00 - 週次レポート作成
```

### 10.3 月次チェックリスト

```
第1月曜
[ ] 9:00 - 月次運用会議

第2木曜
[ ] 14:00 - バックアップリストアテスト

第2金曜
[ ] 10:00 - ユーザーアカウント監査

第3木曜
[ ] 14:00 - 異地バックアップ確認

第4木曜  (or 最終木曜)
[ ] 10:00 - 容量計画レビュー
```

---

## 11. ドキュメント管理

### 11.1 本マニュアルの更新ルール

- **内容の見直し:** 毎年1月
- **手順の更新:** 変更が生じた時点で直ちに更新
- **テンプレート改善:** 月次定例会議で改善提案を募集

### 11.2 保存場所

- **マスター:** `D:\Mirai-DX-Management-System\docs\04_運用・保守\`
- **バックアップ:** 月1回、GitHubにコミット
- **配布:** 全IT部門メンバーに Confluence リンク共有

---

## 12. 関連ドキュメント

- 障害対応手順書 (`Incident-Response.md`)
- 保守計画書 (`Maintenance-Plan.md`)
- システム構築ドキュメント (`../03_設計/`)
- ベンダー契約書・SLA

---

**記作成:** 2026年2月15日
**最終レビュー:** 2026年2月15日
**次回レビュー予定:** 2027年1月15日
